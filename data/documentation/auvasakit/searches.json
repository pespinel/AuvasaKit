{"primaryContentSections":[{"kind":"content","content":[{"type":"heading","text":"Geographic Searches","level":2,"anchor":"Geographic-Searches"},{"type":"heading","text":"Find Nearest Stop","level":3,"anchor":"Find-Nearest-Stop"},{"type":"paragraph","inlineContent":[{"text":"Find the single closest stop to a location:","type":"text"}]},{"type":"codeListing","code":["let userLocation = Coordinate(latitude: 41.6523, longitude: -4.7245)","let nearbyStops = try await client.findNearbyStops(","    coordinate: userLocation,","    radiusMeters: 5000  \/\/ Wide radius to ensure results",")","","if let nearest = nearbyStops.first {","    let distance = userLocation.distance(to: nearest.coordinate)","    print(\"Nearest stop: \\(nearest.name) (\\(Int(distance))m away)\")","}"],"syntax":"swift"},{"type":"heading","text":"Stops Within Walking Distance","level":3,"anchor":"Stops-Within-Walking-Distance"},{"type":"paragraph","inlineContent":[{"text":"Find all stops within a 10-minute walk (~800m):","type":"text"}]},{"type":"codeListing","code":["let walkingRadius = 800.0  \/\/ meters","let stops = try await client.findNearbyStops(","    coordinate: userLocation,","    radiusMeters: walkingRadius",")","","print(\"Found \\(stops.count) stops within walking distance:\")","for stop in stops {","    let distance = userLocation.distance(to: stop.coordinate)","    let walkTime = Int(distance \/ 1.33)  \/\/ ~1.33 m\/s walking speed","    print(\"  \\(stop.name) - \\(walkTime) min walk\")","}"],"syntax":"swift"},{"type":"heading","text":"Stops Along a Route","level":3,"anchor":"Stops-Along-a-Route"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Find stops within a corridor along a route:"}]},{"type":"codeListing","code":["let start = Coordinate(latitude: 41.6523, longitude: -4.7245)","let end = Coordinate(latitude: 41.6600, longitude: -4.7300)","","\/\/ Find stops near both endpoints","let startStops = try await client.findNearbyStops(coordinate: start, radiusMeters: 300)","let endStops = try await client.findNearbyStops(coordinate: end, radiusMeters: 300)","","\/\/ Find route connections","let startStopIds = Set(startStops.map(\\.id))","let endStopIds = Set(endStops.map(\\.id))","","let allRoutes = try await client.fetchRoutes()","","for route in allRoutes {","    let routeTrips = try await client.fetchTrips(routeId: route.id)","","    for trip in routeTrips {","        let tripStopTimes = try await client.fetchStopTimes(tripId: trip.id)","        let tripStops = Set(tripStopTimes.map(\\.stopId))","","        \/\/ Check if route connects start and end","        if !tripStops.intersection(startStopIds).isEmpty &&","           !tripStops.intersection(endStopIds).isEmpty {","            print(\"Route \\(route.shortName) connects these locations\")","        }","    }","}"],"syntax":"swift"},{"type":"heading","text":"Text Searches","level":2,"anchor":"Text-Searches"},{"anchor":"Fuzzy-Stop-Search","text":"Fuzzy Stop Search","type":"heading","level":3},{"inlineContent":[{"text":"Search for stops with tolerance for typos:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["let queries = [\"plasa\", \"plaza\", \"plaça\"]  \/\/ Variations and typos","","var allResults: Set<Stop> = []","for query in queries {","    let results = try await client.searchStops(query: query)","    allResults.formUnion(results)","}","","print(\"Found \\(allResults.count) unique stops matching variations\")"]},{"anchor":"Multi-keyword-Search","text":"Multi-keyword Search","type":"heading","level":3},{"inlineContent":[{"type":"text","text":"Search for stops matching multiple keywords:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["func searchStopsMultiKeyword(keywords: [String]) async throws -> [Stop] {","    var results: Set<Stop> = []","","    for keyword in keywords {","        let matches = try await client.searchStops(query: keyword)","        if results.isEmpty {","            results = Set(matches)","        } else {","            \/\/ Intersection - stops matching ALL keywords","            results.formIntersection(matches)","        }","    }","","    return Array(results)","}","","\/\/ Find stops with both \"plaza\" and \"mayor\"","let stops = try await searchStopsMultiKeyword(keywords: [\"plaza\", \"mayor\"])"]},{"anchor":"Search-by-Stop-Code","text":"Search by Stop Code","type":"heading","level":3},{"inlineContent":[{"type":"text","text":"Find stops by their display code:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["let allStops = try await client.fetchAllStops()","let stopsByCode = allStops.filter { stop in","    stop.code?.lowercased().contains(\"123\") == true","}"]},{"anchor":"Route-Searches","text":"Route Searches","type":"heading","level":2},{"anchor":"Find-Routes-Serving-a-Stop","text":"Find Routes Serving a Stop","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"text":"Get all routes that stop at a specific location:","type":"text"}]},{"code":["let stopId = \"123\"","let stopTimes = try await client.getSchedule(stopId: stopId)","","\/\/ Get unique route IDs","let routeIds = Set(stopTimes.compactMap { stopTime -> String? in","    try? await client.getTrip(id: stopTime.tripId)?.routeId","})","","\/\/ Fetch route details","var routes: [Route] = []","for routeId in routeIds {","    if let route = try await client.getRoute(id: routeId) {","        routes.append(route)","    }","}","","print(\"Routes serving this stop:\")","for route in routes.sorted(by: { $0.shortName < $1.shortName }) {","    print(\"  \\(route.shortName): \\(route.longName)\")","}"],"type":"codeListing","syntax":"swift"},{"anchor":"Find-Wheelchair-Accessible-Routes","text":"Find Wheelchair Accessible Routes","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"Find routes with wheelchair-accessible vehicles:"}]},{"code":["let allTrips = try await client.fetchAllTrips()","let accessibleTripRoutes = Set(","    allTrips","        .filter { $0.wheelchairAccessible == .accessible }","        .map(\\.routeId)",")","","var accessibleRoutes: [Route] = []","for routeId in accessibleTripRoutes {","    if let route = try await client.getRoute(id: routeId) {","        accessibleRoutes.append(route)","    }","}","","print(\"♿️ \\(accessibleRoutes.count) routes with wheelchair accessibility\")"],"type":"codeListing","syntax":"swift"},{"anchor":"Time-Based-Searches","text":"Time-Based Searches","type":"heading","level":2},{"anchor":"Next-Departures-After-Current-Time","text":"Next Departures After Current Time","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"Get upcoming buses in the next hour:"}]},{"code":["let now = Date()","let calendar = Calendar.current","","\/\/ Format current time","let hour = calendar.component(.hour, from: now)","let minute = calendar.component(.minute, from: now)","let currentTime = String(format: \"%02d:%02d:00\", hour, minute)","","\/\/ Get next hour of departures","let departures = try await client.fetchUpcomingDepartures(","    stopId: \"123\",","    afterTime: currentTime,","    limit: 20",")","","\/\/ Filter to next hour","let oneHourLater = now.addingTimeInterval(3600)","","let nextHourDepartures = departures.filter { stopTime in","    \/\/ Parse time and check if within next hour","    guard let departureDate = parseGTFSTime(stopTime.departureTime, baseDate: now) else {","        return false","    }","    return departureDate <= oneHourLater","}","","print(\"\\(nextHourDepartures.count) buses in the next hour\")"],"type":"codeListing","syntax":"swift"},{"anchor":"Late-Night-Service","text":"Late Night Service","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"text":"Find routes running late at night:","type":"text"}]},{"code":["let lateNightTrips = try await client.fetchAllStopTimes()","    .filter { stopTime in","        \/\/ GTFS times can be > 24:00:00 for next-day service","        if let hour = Int(stopTime.departureTime.prefix(2)) {","            return hour >= 23 || hour <= 5","        }","        return false","    }","","let lateNightRoutes = Set(","    try await lateNightTrips.asyncMap { stopTime -> String? in","        try? await client.getTrip(id: stopTime.tripId)?.routeId","    }.compactMap { $0 }",")","","print(\"Routes with late night service: \\(lateNightRoutes.count)\")"],"type":"codeListing","syntax":"swift"},{"anchor":"Real-Time-Searches","text":"Real-Time Searches","type":"heading","level":2},{"anchor":"Find-Available-Buses","text":"Find Available Buses","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"text":"Get vehicles that are currently in service:","type":"text"}]},{"code":["let allVehicles = try await client.fetchVehiclePositions()","","\/\/ Filter by occupancy","let availableBuses = allVehicles.filter { vehicle in","    switch vehicle.occupancyStatus {","    case .manySeatsAvailable, .fewSeatsAvailable:","        return true","    default:","        return false","    }","}","","print(\"\\(availableBuses.count) buses with available seats\")"],"type":"codeListing","syntax":"swift"},{"anchor":"Buses-Approaching-a-Stop","text":"Buses Approaching a Stop","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"Find buses that will arrive soon:"}]},{"code":["let stopLocation = Coordinate(latitude: 41.6523, longitude: -4.7245)","let maxDistance = 500.0  \/\/ meters","let maxSpeed = 50.0  \/\/ km\/h","","let vehicles = try await client.fetchVehiclePositions()","","let approaching = vehicles.filter { vehicle in","    let distance = stopLocation.distance(to: vehicle.position)","","    \/\/ Within max distance","    guard distance <= maxDistance else { return false }","","    \/\/ Calculate bearing to stop","    if let bearing = vehicle.bearing {","        let bearingToStop = LocationUtils.bearing(from: vehicle.position, to: stopLocation)","","        \/\/ Check if heading towards stop (within 45°)","        let diff = abs(bearing - bearingToStop)","        return diff < 45 || diff > 315","    }","","    return true","}","","print(\"\\(approaching.count) buses approaching stop\")"],"type":"codeListing","syntax":"swift"},{"anchor":"Combined-Searches","text":"Combined Searches","type":"heading","level":2},{"anchor":"Best-Next-Bus","text":"Best Next Bus","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"text":"Find the soonest bus to a destination:","type":"text"}]},{"code":["func findBestBus(","    from: String,  \/\/ Stop ID","    to: String,    \/\/ Stop ID","    client: AuvasaClient",") async throws -> (route: Route, arrival: Date)? {","","    \/\/ Get arrivals at origin stop","    let arrivals = try await client.getNextArrivals(stopId: from, limit: 20)","","    \/\/ Check which routes serve destination","    for arrival in arrivals {","        let tripStopTimes = try await client.fetchStopTimes(tripId: arrival.trip.id)","","        \/\/ Check if trip goes to destination","        if tripStopTimes.contains(where: { $0.stopId == to }) {","            return (arrival.route, arrival.bestTime)","        }","    }","","    return nil","}","","if let best = try await findBestBus(from: \"123\", to: \"456\", client: client) {","    print(\"Take route \\(best.route.shortName) at \\(best.arrival)\")","}"],"type":"codeListing","syntax":"swift"},{"anchor":"Performance-Optimization","text":"Performance Optimization","type":"heading","level":2},{"anchor":"Caching-Search-Results","text":"Caching Search Results","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"text":"Cache frequently accessed data:","type":"text"}]},{"code":["actor SearchCache {","    private var stopCache: [String: [Stop]] = [:]","","    func cachedNearbyStops(","        coordinate: Coordinate,","        radius: Double,","        client: AuvasaClient","    ) async throws -> [Stop] {","        let key = \"\\(coordinate.latitude),\\(coordinate.longitude),\\(radius)\"","","        if let cached = stopCache[key] {","            return cached","        }","","        let results = try await client.findNearbyStops(","            coordinate: coordinate,","            radiusMeters: radius","        )","","        stopCache[key] = results","        return results","    }","}"],"type":"codeListing","syntax":"swift"},{"anchor":"Batch-Requests","text":"Batch Requests","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"text":"Minimize API calls by batching:","type":"text"}]},{"code":["\/\/ Instead of this:","for stopId in stopIds {","    let stop = try await client.getStop(id: stopId)","    \/\/ Process stop","}","","\/\/ Do this:","let allStops = try await client.fetchAllStops()","let stopsById = Dictionary(uniqueKeysWithValues: allStops.map { ($0.id, $0) })","","for stopId in stopIds {","    if let stop = stopsById[stopId] {","        \/\/ Process stop","    }","}"],"type":"codeListing","syntax":"swift"}]}],"kind":"article","variants":[{"paths":["\/documentation\/auvasakit\/searches"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/auvasakit.AuvasaKit\/documentation\/AuvasaKit\/Searches","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"Advanced search patterns and use cases."}],"sections":[],"seeAlsoSections":[{"identifiers":["doc:\/\/auvasakit.AuvasaKit\/documentation\/AuvasaKit\/StaticData","doc:\/\/auvasakit.AuvasaKit\/documentation\/AuvasaKit\/RealTimeData","doc:\/\/auvasakit.AuvasaKit\/documentation\/AuvasaKit\/LocationUtils"],"anchor":"Related-Documentation","title":"Related Documentation"},{"identifiers":["doc:\/\/auvasakit.AuvasaKit\/documentation\/AuvasaKit\/StaticData"],"anchor":"Static-Data","title":"Static Data","generated":true}],"hierarchy":{"paths":[["doc:\/\/auvasakit.AuvasaKit\/documentation\/AuvasaKit"]]},"metadata":{"role":"article","title":"Search Examples","modules":[{"name":"AuvasaKit"}],"roleHeading":"Article"},"schemaVersion":{"patch":0,"major":0,"minor":3},"references":{"doc://auvasakit.AuvasaKit/documentation/AuvasaKit/LocationUtils":{"navigatorTitle":[{"kind":"identifier","text":"LocationUtils"}],"kind":"symbol","url":"\/documentation\/auvasakit\/locationutils","role":"symbol","fragments":[{"kind":"keyword","text":"enum"},{"kind":"text","text":" "},{"kind":"identifier","text":"LocationUtils"}],"abstract":[{"type":"text","text":"Utilities for location and distance calculations"}],"title":"LocationUtils","type":"topic","identifier":"doc:\/\/auvasakit.AuvasaKit\/documentation\/AuvasaKit\/LocationUtils"},"doc://auvasakit.AuvasaKit/documentation/AuvasaKit/RealTimeData":{"type":"topic","url":"\/documentation\/auvasakit\/realtimedata","identifier":"doc:\/\/auvasakit.AuvasaKit\/documentation\/AuvasaKit\/RealTimeData","kind":"article","title":"Real-Time Data","role":"article","abstract":[{"text":"Access live transit information from AUVASA’s GTFS Real-Time feed.","type":"text"}]},"doc://auvasakit.AuvasaKit/documentation/AuvasaKit":{"identifier":"doc:\/\/auvasakit.AuvasaKit\/documentation\/AuvasaKit","kind":"symbol","title":"AuvasaKit","url":"\/documentation\/auvasakit","abstract":[{"type":"text","text":"Modern Swift SDK for accessing AUVASA (Autobuses Urbanos de Valladolid) transit data."}],"role":"collection","type":"topic"},"doc://auvasakit.AuvasaKit/documentation/AuvasaKit/StaticData":{"kind":"article","type":"topic","abstract":[{"type":"text","text":"Query GTFS static data for stops, routes, schedules, and more."}],"role":"article","title":"Static Data","identifier":"doc:\/\/auvasakit.AuvasaKit\/documentation\/AuvasaKit\/StaticData","url":"\/documentation\/auvasakit\/staticdata"}}}